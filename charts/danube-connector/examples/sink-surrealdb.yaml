# SurrealDB Sink Connector
# Install: helm install surrealdb-sink danube/danube-connector -n danube -f sink-surrealdb.yaml

image:
  repository: ghcr.io/danube-messaging/danube-sink-surrealdb
  tag: "latest"

env:
  CONNECTOR_CONFIG_PATH: /etc/connector.toml
  DANUBE_SERVICE_URL: "http://danube-core-broker:6650"
  CONNECTOR_NAME: "surrealdb-sink"
  SURREALDB_URL: "surrealdb:8000"
  RUST_LOG: "info,danube_sink_surrealdb=debug"

secretEnv:
  SURREALDB_USERNAME: "root"
  SURREALDB_PASSWORD: "root"

config:
  inline: |
    danube_service_url = "http://danube-core-broker:6650"
    connector_name = "surrealdb-sink"

    [retry]
    max_retries = 3
    retry_backoff_ms = 1000
    max_backoff_ms = 30000

    [processing]
    batch_size = 100
    batch_timeout_ms = 1000
    poll_interval_ms = 100
    metrics_port = 9090
    log_level = "info"

    [surrealdb]
    url = "surrealdb:8000"
    namespace = "default"
    database = "default"
    connection_timeout_secs = 30
    request_timeout_secs = 30
    batch_size = 100
    flush_interval_ms = 3000

    [[surrealdb.topic_mappings]]
    topic = "/default/events"
    subscription = "surrealdb-sink-sub"
    subscription_type = "Shared"
    table_name = "events"
    expected_schema_subject = "events-v1"
    storage_mode = "Document"
    include_danube_metadata = true
