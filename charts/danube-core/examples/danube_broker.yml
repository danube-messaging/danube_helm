# Danube cluster name
cluster_name: "MY_CLUSTER"

# Broker Services Configuration
broker:
  # Hostname or IP address for all broker services
  host: "0.0.0.0"
  ports:
    # Client connections (producers/consumers)
    client: 6650
    # Admin API
    admin: 50051
    # Prometheus metrics exporter
    prometheus: 9040
  # Optional: advertised addresses for proxy/k8s mode.
  # If omitted, bind address (host:ports.client) is used for both broker_url and connect_url.
  # NOTE: In Helm deployments the CLI flags --advertised-addr and --connect-url override
  # this section, so you typically leave it commented out and configure via values.yaml instead.
  # advertised_listeners:
  #   # Internal: per-pod address reachable inside the cluster (broker identity, inter-broker)
  #   broker_url: "danube-core-broker-0.danube-core-broker-headless.danube.svc.cluster.local:6650"
  #   # External: shared address reachable by external clients via gRPC proxy/ingress
  #   connect_url: "broker.example.com:6650"

# Metadata Store Configuration (etcd)
meta_store:
  host: "danube-core-etcd"
  port: 2379

# Namespaces to be created on boot
bootstrap_namespaces:
  - "default"

# Allow producers to auto-create topics when missing
auto_create_topics: true

# Security Configuration
auth:
  mode: none # Options: none, tls, tlswithjwt
  tls:
    cert_file: "./cert/server-cert.pem"
    key_file: "./cert/server-key.pem"
    ca_file: "./cert/ca-cert.pem"
    verify_client: false
  jwt:
    secret_key: "your-secret-key"
    issuer: "danube-auth"
    expiration_time: 3600 # in seconds

# Load Manager Configuration (Automated Proactive Rebalancing)
load_manager:
  assignment_strategy: "fair"
  load_report_interval_seconds: 30
  rebalancing:
    enabled: false
    aggressiveness: "balanced"
    check_interval_seconds: 300
    max_moves_per_hour: 10
    cooldown_seconds: 60
    min_brokers_for_rebalance: 2
    min_topic_age_seconds: 300
    blacklist_topics: []

# WAL and Cloud Storage Configuration
wal_cloud:
  wal:
    dir: "/danube-data/wal"
    file_name: "wal.log"
    cache_capacity: 1024
    file_sync:
      interval_ms: 5000
      max_batch_bytes: 10485760
    rotation:
      max_bytes: 536870912
    retention:
      time_minutes: 2880
      size_mb: 20480
      check_interval_minutes: 5
  uploader:
    enabled: true
    interval_seconds: 30
    root_prefix: "/danube-data"
    max_object_mb: 256
  cloud:
    backend: "fs"
    root: "/danube-data/cloud-storage"
  metadata:
    etcd_endpoint: "danube-core-etcd:2379"
    in_memory: false

# Broker policies, that can be overwritten by namespace / topic policies
policies:
  max_producers_per_topic: 0
  max_subscriptions_per_topic: 0
  max_consumers_per_topic: 0
  max_consumers_per_subscription: 0
  max_publish_rate: 0
  max_subscription_dispatch_rate: 0
  max_message_size: 10485760
